<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RCì¹´ ë¼ì¸íŠ¸ë ˆì´ì„œ</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1, h2 { color: #00d8ff; }
    button, input[type=range] {
      margin: 4px;
      padding: 10px;
      font-size: 16px;
    }
    .status-box, .log-box {
      background: #222;
      margin: 10px auto;
      padding: 10px;
      max-width: 640px;
      border-radius: 8px;
      text-align: left;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h1>ğŸ“· ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</h1>
  <img src="{{ url_for('video_feed') }}" alt="Video Feed" width="90%" style="max-width: 640px; border: 2px solid #555;" />

  <h2>ğŸ® ìˆ˜ë™ ì¡°ì‘</h2>
  <div>
    <button onclick="send('FORWARD')">â¬† ì „ì§„</button><br>
    <button onclick="send('LEFT')">â¬… ì¢ŒíšŒì „</button>
    <button onclick="send('STOP')">â¹ ì •ì§€</button>
    <button onclick="send('RIGHT')">â¡ ìš°íšŒì „</button><br>
    <button onclick="send('BACK')">â¬‡ í›„ì§„</button>
  </div>

  <h3>ì†ë„ ì¡°ì ˆ (FORWARD)</h3>
  <input type="range" id="speedSlider" min="1460" max="1560" value="1560" oninput="updateSpeed()" />
  <span id="speedVal">1560</span>

  <h3>ğŸ” ëª¨ë“œ ì„ íƒ</h3>
  <button onclick="setMode('auto')">ìë™ ëª¨ë“œ</button>
  <button onclick="setMode('manual')">ìˆ˜ë™ ëª¨ë“œ</button>

  <div class="status-box">
    <h4>ğŸ“¡ í˜„ì¬ ìƒíƒœ</h4>
    <p>ëª¨ë“œ: <span id="mode">-</span></p>
    <p>ìµœê·¼ ëª…ë ¹: <span id="last">-</span></p>
    <p>ì†ë„: <span id="spd">-</span></p>
  </div>

  <div class="log-box">
    <h4>ğŸ“ ëª…ë ¹ ë¡œê·¸</h4>
    <ul id="log"></ul>
  </div>

  <div class="log-box">
    <h4>ğŸ–¨ ì•„ë‘ì´ë…¸ ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°</h4>
    <ul id="serialBox"></ul>
  </div>

  <script>
    function send(cmd) {
      const speed = document.getElementById("speedSlider").value;
      fetch(`/control?cmd=${cmd}&speed=${speed}`);
    }

    function setMode(type) {
      fetch(`/mode?type=${type}`);
    }

    function updateSpeed() {
      const speed = document.getElementById("speedSlider").value;
      document.getElementById("speedVal").innerText = speed;
    }

    function updateStatus() {
      fetch("/status").then(res => res.json()).then(data => {
        document.getElementById("mode").innerText = data.mode;
        document.getElementById("last").innerText = data.last_cmd;
        document.getElementById("spd").innerText = data.speed;
        const logEl = document.getElementById("log");
        logEl.innerHTML = "";
        data.log.forEach(line => {
          const li = document.createElement("li");
          li.innerText = line;
          logEl.appendChild(li);
        });
      });
    }

    function updateSerialLog() {
      fetch("/serial_log").then(res => res.json()).then(data => {
        const box = document.getElementById("serialBox");
        box.innerHTML = "";
        data.forEach(line => {
          const li = document.createElement("li");
          li.innerText = line;
          box.appendChild(li);
        });
        box.scrollTop = box.scrollHeight;
      });
    }

    setInterval(() => {
      updateStatus();
      updateSerialLog();
    }, 1000);
  </script>

</body>
</html>
