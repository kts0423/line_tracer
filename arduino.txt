#include <Servo.h>

// í•€ ì„¤ì •
const int SERVO_PIN = 9;   // ì¡°í–¥ ì„œë³´
const int ESC_PIN = 10;    // ì£¼í–‰ ESC

Servo steeringServo;
Servo driveESC;

String input = "";
bool auto_mode = false;
int steer_offset = 0;
const int CENTER_ANGLE = 90;

void setup() {
  Serial.begin(9600);
  steeringServo.attach(SERVO_PIN);
  driveESC.attach(ESC_PIN);

  steeringServo.write(CENTER_ANGLE);
  driveESC.writeMicroseconds(1500); // ì •ì§€
  delay(2000);
  Serial.println("âœ… RCì¹´ ì¤€ë¹„ ì™„ë£Œ");
}

void loop() {
  while (Serial.available()) {
    char c = Serial.read();
    if (c == '\n') {
      handleCommand(input);
      input = "";
    } else {
      input += c;
    }
  }

  if (auto_mode) {
    int angle = CENTER_ANGLE - steer_offset;
    angle = constrain(angle, 45, 135);
    steeringServo.write(angle);

    int speed = (steer_offset == 9999) ? 1460 : 1560;
    driveESC.writeMicroseconds(speed);
  }
}

void handleCommand(String cmd) {
  cmd.trim();
  Serial.print("ğŸ“© ìˆ˜ì‹ : ");
  Serial.println(cmd);

  if (cmd == "MODE:AUTO") {
    auto_mode = true;
    Serial.println("ğŸš— ìë™ ì£¼í–‰ ì‹œì‘");
  } else if (cmd.startsWith("E:")) {
    String val = cmd.substring(2);
    if (val == "9999") {
      steer_offset = 9999; // ì„ ì„ ëª» ì°¾ì•˜ë‹¤ëŠ” í‘œì‹œ
    } else {
      steer_offset = val.toInt();
    }
    Serial.print("â†ª ì¡°í–¥ ì˜¤ì°¨: ");
    Serial.println(steer_offset);
  } else {
    Serial.println("âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹");
  }
}
