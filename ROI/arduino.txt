#include <Servo.h>

// 핀 설정
const int SERVO_PIN = 9;   // 조향 서보
const int ESC_PIN = 10;    // 주행 ESC

Servo steeringServo;
Servo driveESC;

String input = "";
const int CENTER_ANGLE = 90;

void setup() {
  Serial.begin(9600);
  steeringServo.attach(SERVO_PIN);
  driveESC.attach(ESC_PIN);

  steeringServo.write(CENTER_ANGLE);
  driveESC.writeMicroseconds(1500);  // 정지
  delay(2000);
  Serial.println("[OK] RC Car Ready (Auto Drive Mode)");
}

void loop() {
  while (Serial.available()) {
    char c = Serial.read();
    if (c == '\n') {
      handleCommand(input);
      input = "";
    } else {
      input += c;
    }
  }
}

void handleCommand(String cmd) {
  cmd.trim();
  Serial.print("[RX] ");
  Serial.println(cmd);

  if (cmd.startsWith("E:")) {
    String val = cmd.substring(2);
    int angle;
    int speed;

    if (val == "9999") {
      angle = CENTER_ANGLE;  // 중립 조향
      speed = 1460;          // 후진
    } else {
      int err = val.toInt();
      angle = CENTER_ANGLE - constrain(err, -50, 50);
      speed = 1560;          // 전진
    }

    angle = constrain(angle, 45, 135);
    steeringServo.write(angle);
    driveESC.writeMicroseconds(speed);

    Serial.print("[CMD] Angle: ");
    Serial.print(angle);
    Serial.print(" | Speed: ");
    Serial.println(speed);
  } else {
    Serial.println("[WARN] Unknown command");
  }
}


**후진까진됨됨